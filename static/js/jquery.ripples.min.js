!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(e.$)}(this,function(e){"use strict";function t(e){return"%"==e[e.length-1]}function i(e){var t=e.split(" ");if(1!==t.length)return t.map(function(t){switch(e){case"center":return"50%";case"top":case"left":return"0";case"right":case"bottom":return"100%";default:return t}});switch(e){case"center":return["50%","50%"];case"top":return["50%","0"];case"bottom":return["50%","100%"];case"left":return["0","50%"];case"right":return["100%","50%"];default:return[e,"50%"]}}function n(e,t){function i(e,t){var i=a.createShader(e);if(a.shaderSource(i,t),a.compileShader(i),!a.getShaderParameter(i,a.COMPILE_STATUS))throw new Error("compile error: "+a.getShaderInfoLog(i));return i}var n={};if(n.id=a.createProgram(),a.attachShader(n.id,i(a.VERTEX_SHADER,e)),a.attachShader(n.id,i(a.FRAGMENT_SHADER,t)),a.linkProgram(n.id),!a.getProgramParameter(n.id,a.LINK_STATUS))throw new Error("link error: "+a.getProgramInfoLog(n.id));n.uniforms={},n.locations={},a.useProgram(n.id),a.enableVertexAttribArray(0);for(var r,o,s=/uniform (\w+) (\w+)/g,l=e+t;null!=(r=s.exec(l));)o=r[2],n.locations[o]=a.getUniformLocation(n.id,o);return n}function r(e,t){a.activeTexture(a.TEXTURE0+(t||0)),a.bindTexture(a.TEXTURE_2D,e)}function o(e){var t=/url\(["']?([^"']*)["']?\)/.exec(e);return null==t?null:t[1]}function s(e){return e.match(/^data:/)}var a,l=(e=e&&"default"in e?e.default:e)(window),c=function(){function e(e,t,n){var r="OES_texture_"+e,o=r+"_linear",s=o in i,a=[r];return s&&a.push(o),{type:t,arrayType:n,linearSupport:s,extensions:a}}var t=document.createElement("canvas");if(!(a=t.getContext("webgl")||t.getContext("experimental-webgl")))return null;var i={};if(["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear"].forEach(function(e){var t=a.getExtension(e);t&&(i[e]=t)}),!i.OES_texture_float)return null;var n=[];n.push(e("float",a.FLOAT,Float32Array)),i.OES_texture_half_float&&n.push(e("half_float",i.OES_texture_half_float.HALF_FLOAT_OES,null));var r=a.createTexture(),o=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,o),a.bindTexture(a.TEXTURE_2D,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(var s=null,l=0;l<n.length;l++)if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,32,32,0,a.RGBA,n[l].type,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,r,0),a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE){s=n[l];break}return s}(),u=function(e,t){try{return new ImageData(e,t)}catch(i){return document.createElement("canvas").getContext("2d").createImageData(e,t)}}(32,32);e("head").prepend("<style>.jquery-ripples { position: relative; z-index: 0; }</style>");var d=function(t,i){function n(){r.destroyed||(r.step(),requestAnimationFrame(n))}var r=this;this.$el=e(t),this.interactive=i.interactive,this.resolution=i.resolution,this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]),this.perturbance=i.perturbance,this.dropRadius=i.dropRadius,this.crossOrigin=i.crossOrigin,this.imageUrl=i.imageUrl;var o=document.createElement("canvas");o.width=this.$el.innerWidth(),o.height=this.$el.innerHeight(),this.canvas=o,this.$canvas=e(o),this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:-1}),this.$el.addClass("jquery-ripples").append(o),this.context=a=o.getContext("webgl")||o.getContext("experimental-webgl"),c.extensions.forEach(function(e){a.getExtension(e)}),this.updateSize=this.updateSize.bind(this),e(window).on("resize",this.updateSize),this.textures=[],this.framebuffers=[],this.bufferWriteIndex=0,this.bufferReadIndex=1;for(var s=c.arrayType,l=s?new s(this.resolution*this.resolution*4):null,u=0;2>u;u++){var d=a.createTexture(),p=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,p),a.bindTexture(a.TEXTURE_2D,d),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,c.linearSupport?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c.linearSupport?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.resolution,this.resolution,0,a.RGBA,c.type,l),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0),this.textures.push(d),this.framebuffers.push(p)}this.quad=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.quad),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),a.STATIC_DRAW),this.initShaders(),this.initTexture(),this.setTransparentTexture(),this.loadImage(),a.clearColor(0,0,0,0),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),this.visible=!0,this.running=!0,this.inited=!0,this.destroyed=!1,this.setupPointerEvents(),requestAnimationFrame(n)};d.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:.03,interactive:!0,crossOrigin:""},d.prototype={setupPointerEvents:function(){function e(){return i.visible&&i.running&&i.interactive}function t(t,n){e()&&i.dropAtPointer(t,i.dropRadius*(n?1.5:1),n?.14:.01)}var i=this;this.$el.on("mousemove.ripples",function(e){t(e)}).on("touchmove.ripples touchstart.ripples",function(e){for(var i=e.originalEvent.changedTouches,n=0;n<i.length;n++)t(i[n])}).on("mousedown.ripples",function(e){t(e,!0)})},loadImage:function(){var e=this;a=this.context;var t=this.imageUrl||o(this.originalCssBackgroundImage)||o(this.$el.css("backgroundImage"));if(t!=this.imageSource)if(this.imageSource=t,this.imageSource){var i=new Image;i.onload=function(){function t(e){return 0==(e&e-1)}a=e.context;var n=t(i.width)&&t(i.height)?a.REPEAT:a.CLAMP_TO_EDGE;a.bindTexture(a.TEXTURE_2D,e.backgroundTexture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,i),e.backgroundWidth=i.width,e.backgroundHeight=i.height,e.hideCssBackground()},i.onerror=function(){a=e.context,e.setTransparentTexture()},i.crossOrigin=s(this.imageSource)?null:this.crossOrigin,i.src=this.imageSource}else this.setTransparentTexture()},step:function(){a=this.context,this.visible&&(this.computeTextureBoundaries(),this.running&&this.update(),this.render())},drawQuad:function(){a.bindBuffer(a.ARRAY_BUFFER,this.quad),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_FAN,0,4)},render:function(){a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.canvas.width,this.canvas.height),a.enable(a.BLEND),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.useProgram(this.renderProgram.id),r(this.backgroundTexture,0),r(this.textures[0],1),a.uniform1f(this.renderProgram.locations.perturbance,this.perturbance),a.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft),a.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight),a.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio),a.uniform1i(this.renderProgram.locations.samplerBackground,0),a.uniform1i(this.renderProgram.locations.samplerRipples,1),this.drawQuad(),a.disable(a.BLEND)},update:function(){a.viewport(0,0,this.resolution,this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),r(this.textures[this.bufferReadIndex]),a.useProgram(this.updateProgram.id),this.drawQuad(),this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex,this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var e,n=this.$el.css("background-size"),r=this.$el.css("background-attachment"),o=i(this.$el.css("background-position"));if("fixed"==r?((e={left:window.pageXOffset,top:window.pageYOffset}).width=l.width(),e.height=l.height()):((e=this.$el.offset()).width=this.$el.innerWidth(),e.height=this.$el.innerHeight()),"cover"==n)var s=Math.max(e.width/this.backgroundWidth,e.height/this.backgroundHeight),a=this.backgroundWidth*s,c=this.backgroundHeight*s;else if("contain"==n)var s=Math.min(e.width/this.backgroundWidth,e.height/this.backgroundHeight),a=this.backgroundWidth*s,c=this.backgroundHeight*s;else{var a=(n=n.split(" "))[0]||"",c=n[1]||a;t(a)?a=e.width*parseFloat(a)/100:"auto"!=a&&(a=parseFloat(a)),t(c)?c=e.height*parseFloat(c)/100:"auto"!=c&&(c=parseFloat(c)),"auto"==a&&"auto"==c?(a=this.backgroundWidth,c=this.backgroundHeight):("auto"==a&&(a=this.backgroundWidth*(c/this.backgroundHeight)),"auto"==c&&(c=this.backgroundHeight*(a/this.backgroundWidth)))}var u=o[0],d=o[1];u=t(u)?e.left+(e.width-a)*parseFloat(u)/100:e.left+parseFloat(u),d=t(d)?e.top+(e.height-c)*parseFloat(d)/100:e.top+parseFloat(d);var p=this.$el.offset();this.renderProgram.uniforms.topLeft=new Float32Array([(p.left-u)/a,(p.top-d)/c]),this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/a,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/c]);var f=Math.max(this.canvas.width,this.canvas.height);this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/f,this.canvas.height/f])},initShaders:function(){var e=["attribute vec2 vertex;","varying vec2 coord;","void main() {","coord = vertex * 0.5 + 0.5;","gl_Position = vec4(vertex, 0.0, 1.0);","}"].join("\n");this.dropProgram=n(e,["precision highp float;","const float PI = 3.141592653589793;","uniform sampler2D texture;","uniform vec2 center;","uniform float radius;","uniform float strength;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);","drop = 0.5 - cos(drop * PI) * 0.5;","info.r += drop * strength;","gl_FragColor = info;","}"].join("\n")),this.updateProgram=n(e,["precision highp float;","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","vec2 dx = vec2(delta.x, 0.0);","vec2 dy = vec2(0.0, delta.y);","float average = (","texture2D(texture, coord - dx).r +","texture2D(texture, coord - dy).r +","texture2D(texture, coord + dx).r +","texture2D(texture, coord + dy).r",") * 0.25;","info.g += (average - info.r) * 2.0;","info.g *= 0.978;","info.r += info.g;","gl_FragColor = info;","}"].join("\n")),a.uniform2fv(this.updateProgram.locations.delta,this.textureDelta),this.renderProgram=n(["precision highp float;","attribute vec2 vertex;","uniform vec2 topLeft;","uniform vec2 bottomRight;","uniform vec2 containerRatio;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);","backgroundCoord.y = 1.0 - backgroundCoord.y;","ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;","gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);","}"].join("\n"),["precision highp float;","uniform sampler2D samplerBackground;","uniform sampler2D samplerRipples;","uniform vec2 delta;","uniform float perturbance;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","float height = texture2D(samplerRipples, ripplesCoord).r;","float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;","float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;","vec3 dx = vec3(delta.x, heightX - height, 0.0);","vec3 dy = vec3(0.0, heightY - height, delta.y);","vec2 offset = -normalize(cross(dy, dx)).xz;","float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);vec4 bg = texture2D(samplerBackground, backgroundCoord + offset * perturbance);gl_FragColor = bg + vec4(vec3(specular * bg.a), 0.0);","}"].join("\n")),a.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.backgroundTexture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR)},setTransparentTexture:function(){a.bindTexture(a.TEXTURE_2D,this.backgroundTexture),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,u)},hideCssBackground:function(){var e=this.$el[0].style.backgroundImage;"none"!=e&&(this.originalInlineCss=e,this.originalCssBackgroundImage=this.$el.css("backgroundImage"),this.$el.css("backgroundImage","none"))},restoreCssBackground:function(){this.$el.css("backgroundImage",this.originalInlineCss||"")},dropAtPointer:function(e,t,i){var n=parseInt(this.$el.css("border-left-width"))||0,r=parseInt(this.$el.css("border-top-width"))||0;this.drop(e.pageX-this.$el.offset().left-n,e.pageY-this.$el.offset().top-r,t,i)},drop:function(e,t,i,n){a=this.context;var o=this.$el.innerWidth(),s=this.$el.innerHeight(),l=Math.max(o,s);i/=l;var c=new Float32Array([(2*e-o)/l,(s-2*t)/l]);a.viewport(0,0,this.resolution,this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),r(this.textures[this.bufferReadIndex]),a.useProgram(this.dropProgram.id),a.uniform2fv(this.dropProgram.locations.center,c),a.uniform1f(this.dropProgram.locations.radius,i),a.uniform1f(this.dropProgram.locations.strength,n),this.drawQuad(),this.swapBufferIndices()},updateSize:function(){var e=this.$el.innerWidth(),t=this.$el.innerHeight();e==this.canvas.width&&t==this.canvas.height||(this.canvas.width=e,this.canvas.height=t)},destroy:function(){this.$el.off(".ripples").removeClass("jquery-ripples").removeData("ripples"),a=null,e(window).off("resize",this.updateSize),this.$canvas.remove(),this.restoreCssBackground(),this.destroyed=!0},show:function(){this.visible=!0,this.$canvas.show(),this.hideCssBackground()},hide:function(){this.visible=!1,this.$canvas.hide(),this.restoreCssBackground()},pause:function(){this.running=!1},play:function(){this.running=!0},set:function(e,t){switch(e){case"dropRadius":case"perturbance":case"interactive":case"crossOrigin":this[e]=t;break;case"imageUrl":this.imageUrl=t,this.loadImage()}}};var p=e.fn.ripples;e.fn.ripples=function(t){if(!c)throw new Error("Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.");var i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var n=e(this),r=n.data("ripples"),o=e.extend({},d.DEFAULTS,n.data(),"object"==typeof t&&t);(r||"string"!=typeof t)&&(r?"string"==typeof t&&d.prototype[t].apply(r,i):n.data("ripples",r=new d(this,o)))})},e.fn.ripples.Constructor=d,e.fn.ripples.noConflict=function(){return e.fn.ripples=p,this}});